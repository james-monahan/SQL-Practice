WHERE (NOT) IN (values)


IS (NOT) NULL


CASE WHEN condition1 THEN value1
WHEN condition2 THEN value2
WHEN conditionX THEN valueX
ELSE else_value END;


The COALESCE() function returns the first non-null value in a list. (filling na)
SELECT 
  COALESCE(phone, 'NO PHONE') as phone
FROM 
  customers

The NULLIF() function returns NULL if two expressions are equal, otherwise it returns the first expression.
SELECT customer_id,
        NULLIF(title, 'Honorable') as title,

LEAST / GREATEST compare and return value
SELECT 
  LEAST(600.00, base_msrp) as base_msrp


DISTINCT ON query if multiple columns have the same value for distinct_column
 If there are multiple users with the same first name, then the user who was 
 hired first by the company will be pulled by the query.
SELECT DISTINCT ON (first_name)
  *
FROM 
  salespeople
ORDER BY 
  first_name, hire_date;
 
AGG FUNCTIONS
  COUNT, MIN, MAX, SUM, AVG, STDDEV, VAR, REGR_SLOPE(x,y), REGR_INTERCEPT(x,y), CORR(x,y)
  
COMBINE AGGREGATES WITH DATA
-use UNION ALL, NULL for aggregate
OR GROUPING SETS:
SELECT 
  state, 
  gender, 
  COUNT(*)
FROM 
  customers
GROUP BY GROUPING SETS (
  (state),
  (gender),
  (state, gender)
)
ORDER BY 1, 2

ORDERED SET AGGREGATES
MODE, Percentile_count, Percentile_disc

SELECT 
  PERCENTILE_CONT(0.5) 
  WITHIN GROUP (ORDER BY base_msrp) 
  AS median
FROM 
  products;
  
WINDOW FUNCTIONS 
SELECT 
  SUM(CASE WHEN {column1} 
  IS NULL OR {column1} 
  IN ({missing_values}) 
  THEN 1 
  ELSE 0 END)::FLOAT/COUNT(*)
FROM 
  {table1}
  
WINDOW FUNCTIONS OVER SAME WINDOW (alias the window)
SELECT 
  customer_id, title, 
  first_name, last_name, gender,
  COUNT(*) OVER w as total_customers,
  SUM(CASE WHEN title IS NOT NULL THEN 1 ELSE 0 END)
  OVER w as total_customers_title
FROM 
  customers
WINDOW w AS (PARTITION BY gender ORDER BY customer_id)
ORDER BY customer_id;

Stats With Windows
ROW_NUMBER, RANK, DENSE_RANK, NTILE(buckets), LAG(col, offset), LEAD(col, offset)

WINDOW FRAME  
SELECT {columns},
{window_func} OVER (PARTITION BY {partition_key} 
ORDER BY {order_key} {range or rows} 
BETWEEN {frame_start} AND {frame_end})
FROM {table1};

To determine moving average
moving_average_calculation_7 AS (
  SELECT 
    sales_transaction_date, total_sales,
    AVG(total_sales) 
    OVER (ORDER BY 
      sales_transaction_date 
      ROWS BETWEEN 7 PRECEDING (FOLLOWING)
      and CURRENT ROW) AS sales_moving_average_7,
      ROW_NUMBER() OVER (ORDER BY sales_transaction_date) as row_number
      
SELECT 
  sales_transaction_date, total_sales,
  MAX(total_sales) 
  OVER (ORDER BY sales_transaction_date ROWS BETWEEN 30 PRECEDING and 1 PRECEDING)
  AS max_sales_30

